<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/polymer/polymer.html">

<polymer-element name="timer-page">

  <template>
    <div fit>
      <countdown-timer id="timer" target="03:00"></countdown-timer>
      <timer-settings id="settings"></timer-settings>
      <paper-button id="controll">{{startText}}</paper-button>
      <paper-button id="reset">reset</paper-button>
    </div>
  </template>

  <script>
    Polymer('timer-page', {
      startText: 'START',
      stopText : 'STOP',
      disabledAttr : 'disabled',
      ready: function(){
        this.initElm();
        this.bindEvent();
      },
      initElm: function(){
        this.$.controll.addEventListener('click', this.onClickControll.bind(this));
        this.$.reset.addEventListener('click', this.onClickReset.bind(this));
        this.$.timer.addEventListener('click', this.onClickTimer.bind(this));
        this.$.settings.addEventListener('timer-settings-close', this.onCloseTimerSettings.bind(this));
      },
      bindEvent: function(){
        // timer.end -> show times up -> click display -> call reset
      },
      onCloseTimerSettings: function(e){
        var data = e.detail;
        this.$.timer.target = data.time;
        this.$.timer.warning = data.warning;
      },
      onClickTimer: function(){
        this.$.settings.open();
      },
      onClickControll: function(){
        if(this.isStart()){
          this.$.timer.start();
          this.$.reset.setAttribute(this.disabledAttr, '');
        }else{
          this.$.timer.stop();
          this.$.reset.removeAttribute(this.disabledAttr);
        }
        this.toggleControllText();
      },
      isStart: function(){
        var elm = this.$.controll,
            text = elm.innerText;
        return text === this.startText;
      },
      onClickReset: function(){
        if(!this.$.reset.hasAttribute(this.disabledAttr)){
          this.$.timer.reset();
        }
      },
      toggleControllText: function(){
        var elm = this.$.controll,
            next = this.isStart() ? this.stopText : this.startText;
        elm.innerText = next;
      },
    });
  </script>

